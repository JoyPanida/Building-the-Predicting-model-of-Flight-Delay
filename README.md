## การสร้างโมเดลเพื่อทำนายโอกาสการเกิดความล่าช้าของเที่ยวบิน  
### Building-the-Predicting-model-of-Flight-Delay       
  
โปรเจคนี้เป็นการนำเสนอการประยุกต์เทคนิคการเรียนรู้ของเครื่องเพื่อสร้างโมเดลในการทำนายโอกาสการเกิดความล่าช้าของเที่ยวบิน   
จากการใช้ข้อมูลเที่ยวบินของประเทศสหรัฐอเมริกาในปี 2015 จุดประสงค์เพื่อวิเคราะห์ข้อมูลเพื่อหาปัจจัยสำคัญที่ส่งผลกระทบให้เกิดความล่าช้าต่อเที่ยวบินอย่างมีนัยสำคัญแล้วนำมาสร้างเป็นข้อมูลใหม่ เพื่อช่วยให้การเรียนรู้ของเครื่องสามารถนำข้อมูลไปเรียนรู้และสามารถสร้างโมเดลที่ได้ค่าความถูกต้องที่สูงสุดในการทำนายเที่ยวบินที่จะเกิดความล่าช้า โดยผลในการทำนายจากการใช้โมเดลทำนาย ทั้ง 5 โมเดล 1.Gradient Boosting 2.CatBoost 3.SVM 4.Logistic Regression 5.Random forest พบว่าค่าความถูกต้องของโมเดลที่ใช้เทคนิค catboosting มีประสิทธิภาพการทำนายสูงสุด มีค่าร้อยละ 86.8  โดยการทำนายนี้จะสามารถช่วยให้องค์กรการขนส่งทางอากาศ จัดการตารางการเดินทางของสายการบินจะสามารถปรับเที่ยวเที่ยวบินหรือพัฒนา ระยะเวลาที่เหมาะสมในแต่ละเที่ยวบิน    
## กระบวนการสำรวจและวิเคราะห์ข้อมูล (Exploration data analysis)  
การสำรวจข้อมูลเป็นขั้นตอนเริ่มต้นที่สำคัญในการในการประเมินชุดข้อมูลสำหรับการวิเคราะห์ข้อมูลในขั้นตอนสุดท้ายเนื่องจากข้อมูลมีปริมาณมาก ข้อมูลจะกอบไปด้วยข้อมูลที่มีความสอดคล้องและไม่สอดคล้อง หรือ ข้อมูลที่มีคามผิดพลาดขาดหายไป ดังนั้นจึงจำเป็นต้องจัดการกับข้อมูลเหล่านี้ และ สืบค้นข้อมูลที่มีความจำเป็นมาใช้ในการวิเคราะห์เพือให้ให้เข้าถึงข้อมูลย่อยและทราบถึงความสัมพันธ์ระหว่างข้อมูลต่างๆได้ ผลลัพธ์จากการสำรวจข้อมูลจะสามารถสรุปและแสดงในรูปแบบที่เป็นกราฟ ข้อมูลที่ใช้จะเป็นข้อมูลที่จะได้รับตั้งแต่เครื่องบินจอดที่ท่าอากาศยานจนถึงกระทั่งเครื่องบินเก็บล้อเพื่อลอยตัวจากรันเวย์ 
ตารางที่1 อธิบายรายละเอียดจำนวนข้อมูลที่ใช้ในการสำรวจ  
  

รูป
          

### การคัดเลือกแอตทริบิวต์ (Select Feature)
การคัดเลือกแอตริบิต์มีความเกี่ยวข้องหรือเป็นปัจจัยที่ส่งผลต่อการทำนายความล่าช้า แอตทริบิวต์ที่ถูกคัดเลือกจะแสดงดังตารางที่ 2  
รูป


###  Data visualization
การนำข้อมูลมาสร้างกราฟเพื่อแสดงความสัมพันธ์หรือความแตกต่างของข้อมูลที่อาจส่งผลต่อการเรียนรู้ของเครื่อง
1. กราฟแสดงจำนวนเที่ยวบินที่เกิดความล่าช้ากับแอตทริบิวต์ DAY_OF_WEEK จากแผนภูมิกราฟแท่งรูปที่1 จะเห็นได้ว่าข้อมูลมีความแตกต่างกันอย่างชัดเจน ในวันที่6จะมีจำนวนเที่ยวบินที่เกิดความล่าช้าต่ำและวันที่1,2,3,7 จะมีจำนวนใกล้เคียงกันแล้ววันที่4กับ5ของสัปดาห์จะมีจำนวนเที่ยวบินที่เกิดความล่าช้าค่อนข้างสูง  
รูป

2. กราฟแสดงจำนวนเที่ยวบินที่เกิดความล่าช้ากับแอตทริบิวต์ MONTH จากแผนภูมิกราฟแท่งรูปที่2 จะเห็นได้ว่าช่วงตั้งแต่ เดือน9 ถึง เดือน11 จะเกิดความล่าช้าค่อนข้างน้อยเมื่อเทียบกับเดือนอื่นๆ และในเดือนที่2กับเดือนที่4,5 จะมีจำนวนเที่ยวบินที่เกิดความล่าช้าน้อยรองลงมา แล้วเดือนที่เหลือจะมีจำนวนเที่ยวบินที่เกิดความล่าช้าพอๆกัน  
i^x

3. สร้างแอตทริบิวต์ hour ที่นำข้อมูลจากแอตทริบิวต์ 
SCHEDULED_DEPARTURE โดยกำหนดให้แบ่งข้อมูลเป็นแต่ละช่วงของชั่วโมง โดยกราฟจะแสดงจำนวนเที่ยวบินที่เกิดความล่าช้าในแต่ละชั่วโมงจากกราฟแผนภูมิแท่งรูปที่3  
จะพบว่า ชั่วโมงที่มีความล่าช้าต่ำจะอยู่ในชั่วโมงที่ 22, 5, 23, 0, 1, 2 ,3, 4  แล้วมีแนวโน้มที่จะเพิ่มขึ้นในชั่วโมงที่ 8, 20, 9, 7,6,21 แล้วมีแน้วโน้มที่สูงขึ้นอีกระดับนึงในชั่วโมงที่   14, 12, 11, 10 แล้วขึ้นสูงต่อในชั่วโมงที่ 17,15,19,18,16,13  ซึ่งค่อนข้างเห็นได้อย่างชัดเจนว่าชั่วโมงของในแต่ละวันมีความสำคัญต่อการเกิดความล่าช้าของเที่ยวบิน
I^x

###  การแปลงคุณสมบัติของข้อมูล (Feature Transformation) 
การสร้างแอตทริบิวต์ใหม่โดยใช้แอตทริบิวต์ที่มีอยู่ซึ่งแอตทริบิวต์ใหม่เหล่านี้อาจมีการตีความที่แตกต่างจากแอตทริบิวต์ดั้งเดิม 
  
  
**การสร้างแอตทริบิวต์ใหม่(Create New Feature)**

- แอตทริบิวต์ hour นำข้อมูลจาก แอตทริบิวต์ SCHEDULED_DEPARTURE มาแบ่งเป็นช่วงในแต่ละช่วงโมง     
- แอตทริบิวต์ hour_class นำข้อมูลจาก แอตทริบิวต์ใหม่ที่สร้างชื่อ hour ขึ้นมาแบ่งเป็นคลาสโดยอิงวิธีการแบ่งจากกราฟที่แสดงในขั้นตอน Data visualization ซึ่งจะแบ่งออกเป็น 4 คลาส  
- แอตทริบิวต์ day_delay นำข้อมูลจาก แอตทริบิวต์ DAY_OF_WEEK ขึ้นมาแบ่งเป็นคลาสโดยอิงวิธีการแบ่งจากกราฟที่แสดงในขั้นตอน Data visualization ซึ่งจะแบ่งออกเป็น 3 คลาส  
- แอตทริบิวต์ month_class  นำข้อมูลจาก แอตทริบิวต์ MONTH ขึ้นมาแบ่งเป็นคลาสโดยอิงวิธีการแบ่งจากกราฟที่แสดงในขั้นตอน Data visualization ซึ่งจะแบ่งออกเป็น 3 คลาส      
- แอตทริบิวต์ last_dep_delay สร้างแอตทริบิวต์ใหม่เพื่อบอกว่าภายในสนามบินต้นทางเดียวกันในระยะเวลา 30 นาทีก่อนหน้ามีเที่ยวบินที่ออกเดินทางล่าช้ากว่ากำหนดกี่นาทีเมื่อเทียบกับเที่ยวบินปัจจุบัน  
- แอตทริบิวต์ last_arr_delay สร้างแอตทริบิวต์ใหม่เพื่อบอกว่าภายในระยะเวลา 30 นาทีก่อนหน้ามีเที่ยวบินที่มีปลายทางเป็นสนามบินเดียวกันกับสนามบินต้นทางของเที่ยวบินปัจจุบัน และมีความล่าช้าเกินกำหนดกี่นาทีเมื่อเทียบกับเที่ยวบินปัจจุบัน  
  
  
**การทำความสะอาดข้อมูล (Data cleansing)**  
  
เนื่องข้อมูลที่ต้องการ คือ ข้อมูลเที่ยวบินที่มีความล่าช้ากับข้อมูลเที่ยวบินที่บินตามกำหนดแผนการจากมีข้อมูลที่เป็นเที่ยวบินที่ถูกยกเลิก ซึ่งไม่ใช่ข้อมูลที่อยู่ในกลุ่มที่สนใจจึงนำออกและลบข้อมูลที่เป็นค่า missing value ออกจากชุดข้อมูล
**one-hot encoding**  
การทำค่าของแอตทริบิวต์ที่เป็นหมวดหมู่ให้อยู่ในรูปแบบที่เป็นตัวเลขเพื่อให้สามารถนำแอตทริบิวต์นั้นเข้าไปเป็นข้อมูลในชุดฝึกฝนได้ ซึ่งในงานวิจัยนี้จะมี 3 แอตทริบิวต์ ที่ถูกนำมาใช้เทคนิค one-hot encoding คือ month_class, hour_class, day_delay
**ผลการประเมินความสัมพันธ์ของแอตทริบิวต์**  
รูป
  
จากการดู correlation heat map ก่อนที่จะนำข้อมูลเข้าไปใช้ในการฝึกฝน จะพบว่าแอตทริบิวต์ที่มีค่าความสัมพันธ์ที่ทำให้เกิดความล่าช้ามากที่สุดคือ DEPARTURE_DELAY และ TAXI_OUT รองลงมาตามลำดับ  
  
### การสร้างโมเดล (Modeling)
ในขั้นตอนนี้จะทำการสร้างโมเดลโดยใช้เทคนิค Logistic Regression,  Gradients Boosting,  Ensemble(GB, LG, SVM),  CATBoost,  Random Forest, Support Vector  Machine เพื่อการทำนาย ซึ่งการกำหนดข้อมูลที่ใช้ในการทำนายโอกาสความล่าช้าของเที่ยวบินโดย สุ่มข้อมูลมา  0.01 % (58,191 แถว) จากข้อมูลทั้งหมด  (5,819,079 แถว) ในขั้นตอนการเตรียมข้อมูลให้มีความพร้อมสำหรับใช้ในการสร้างโมเดล  การแบ่งชุดข้อมูลในการทำนายจะเป็น 80% ที่เป็นชุดข้อมูลสำหรับฝึกฝน และ 20% เป็นข้อมูลสำหรับการทดสอบ  ซึ่งโมเดลที่ได้จะทำการประมวลผลเพื่อทำนายให้ได้ค่าความถูกต้อง  
  
i^x  

### ผลการดำเนินงานวิจัย 
งานวิจัยฉบับนี้ได้จัดทำเทคนิคต่างๆเพื่อสร้างโมเดลการทำนายความล่าช้าของเที่ยวบินโดยสร้างโมเดลจากเทคนิคทั้ง 6 เทคนิคดังนี้ Logistic Regression, Gradients Boosting,  Ensemble(GB, LG, SVM),  CATBoost,  Random Forest, Support Vector Machine  
i^x  
  

รายละเอียดชื่อย่อโมเดลที่ทดลอง  
Logistic Regression : GB  
Ensemble(GB, LG, SVM) : EN  
Gradients Boosting : LG  
CATBoos : CB  
Random Forest : RF  
Support vector machine : SVM  
  
จากตารางที่ 4 เป็นการแสดงการเปรียบเทียบค่าความถูกต้องที่ได้จากการสร้างโมเดลในการทำนายโอกาสที่จะเกิดความล่าช้าของเที่ยวบินด้วยเทคนิคทั้ง 6 เทคนิค ผลที่ได้จากการสร้างโมเดลเพื่อการทำนายโดยแบ่งข้อมูลเป็นชุดข้อมูลสำหรับการทดสอบ 20 % ของการทดสอบทั้งหมด  และชุดข้อมูลสำหรับฝึกฝน 80 % ของข้อมูลทั้งหมด  [80:20] โดยเทคนิคที่ให้ค่าความถูกต้องมากที่สุดคือ เทคนิค CAT Boost  คิดเป็นร้อยละ 86.6 %  
  
### สรุปผลการทดลอง  
จากผลคาดว่าจะสามารถนำโมเดลไปใช้เพื่อช่วยในการตัดสินใจในการจัดการเที่ยวบินเพื่อลดปัญหาที่ทำให้เกิดความล่าช้าสะสมได้ แต่ยังไม่สามารถนำไปใช้ตัดสินใจแทนได้ทั้งหมดเนื่องจากค่าความถูกต้องสูงสุดได้เพียง86.8% ซึ่งควรได้รับค่าความถูกต้องอย่างน้อย95%ถึงจะอยู่ในจุดที่ยอมรับได้ เพราะว่ากำหนดเที่ยวบินนั้นมีผลกระทบอย่างมากต่อสายการบินและท่าอากาศยาน รวมถึงผู้โดยสารอย่างมาก การนำไปใช้จริงจึงต้องการความถูกต้องที่สูงและต้องการแอตทริบิวต์ที่ใช้ในการวิจัยที่มีความสำคัญเพิ่มขึ้นเพื่อเพิ่มค่าความถูกต้อง เช่นข้อมูลสภาพอากาศ ข้อมูลจำนวนผู้โดยสารในเที่ยวบิน ที่อาจมีความสัมพันธ์กับความล่าช้าของเที่ยวบิน 




k














